!function(){"use strict";angular.module("img.map",[]).directive("imgLevel",function(e,n){return{restrict:"E",scope:{urlSrc:"=",urlIndex:"=",nodeImgId:"=",errSrc:"=",height:"=",width:"=",background:"="},template:'<div class="img-div" ng-style="style"><img class="img-item" ng-src="{{urlSrc}}"/></div>',link:function(m,e){m.style={background:m.background||"rgba(0,0,0,0.1)"};var h=angular.element(e[0].childNodes[0].childNodes);function i(e,n){var i=new Image;i.src=e;var t=i.width,a=i.height,r=m.width,o=m.height;if(n){d=((o-(u=g=((o<r?o:r)<t+2?o<r?o:r:t+2)-2))/2).toFixed(),c=((r-g)/2).toFixed();h.css({height:u+"px",width:g+"px",top:d+"px",left:c+"px"})}else{var s=t/r,l=a/o;if(l<s)var g=r-2,d=((o-(u=parseInt(a/s)-2))/2).toFixed(),c=1;else var u=o-2,d=1,c=((r-(g=parseInt(t/l)-2))/2).toFixed();h.attr("src")!=m.errSrc&&h.css({height:u+"px",width:g+"px",top:d+"px",left:c+"px"})}}h.bind("load",function(){i(m.urlSrc)}),h.bind("error",function(){var e,n;i(m.errSrc,1),e=h,n=m.errSrc,e.attr("src",n)}),h.bind("click",function(){n.$broadcast(m.nodeImgId,m.urlIndex)})}}}).directive("imgViews",function(I,y,B,o){return{restrict:"E",scope:{cameraList:"=",needlessSize:"=",width:"=",height:"=",background:"="},replace:!0,template:'<div class="imgViews">\n<div ng-repeat="it in cameraList track by $index" ng-style="imgSize"><img-level url-src="it.url" url-index="$index" node-img-id="\'ngdialog\'+random" needless-size="needlessSize||false" height="h" width="w" background="background" err-src="\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4AQMAAAADqqSRAAAABlBMVEXm5eX+/v4Lj/UHAAABLUlEQVQ4y+3SwW0DIRAFUAiWONKAJToJ6WxmO5tSKIFDDhxW/LD2eIFNB5ZHAunxGeCA+dTbVwLYAvhVE5AP72oA9Zjw5DMiAHwak93DabXEYxouYc1ruOTD9uGl/79zmt0oL/eXsObZC80Wt5odY7G9esN8vrF2zc3V7uo9Tv1iXPHze24+u/n9Nyd2yuvdCk9GM1umxa7MhvE1zeZQ42wJe1gcWwAP5wB35o1Wl4jssZ3O4bCclo6+Si9zX7IoxGq3gbuT5s0LvgxqVO8hkze0B3WN5dszNa/9JdV7kASveab9FiXCaS5oJuaITfMNMEkSRO0AJibkn4e/PCBgoJhndQNmOHY2C9TJu+tDTYc90E7r/1br/33ZnubhnNb9QsN0bMU4P6qr+dS71R8WH7qWvA/tvAAAAABJRU5ErkJggg==\'"></img-level></div><div id={{"ngdialog"+random}} class="ngdialog-default" ng-class="{ ngdialogClosing : isClose  }" ng-click="stopPropagation($event)">\n<div class="ngdialog-overlay-mask"></div>\n<div class="ngdialog-content-picture" draggable>\n<div class="dialog-body" >\n<img class="dialog-img" src="" onerror="this.src=\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4AQMAAAADqqSRAAAABlBMVEXm5eX+/v4Lj/UHAAABLUlEQVQ4y+3SwW0DIRAFUAiWONKAJToJ6WxmO5tSKIFDDhxW/LD2eIFNB5ZHAunxGeCA+dTbVwLYAvhVE5AP72oA9Zjw5DMiAHwak93DabXEYxouYc1ruOTD9uGl/79zmt0oL/eXsObZC80Wt5odY7G9esN8vrF2zc3V7uo9Tv1iXPHze24+u/n9Nyd2yuvdCk9GM1umxa7MhvE1zeZQ42wJe1gcWwAP5wB35o1Wl4jssZ3O4bCclo6+Si9zX7IoxGq3gbuT5s0LvgxqVO8hkze0B3WN5dszNa/9JdV7kASveab9FiXCaS5oJuaITfMNMEkSRO0AJibkn4e/PCBgoJhndQNmOHY2C9TJu+tDTYc90E7r/1br/33ZnubhnNb9QsN0bMU4P6qr+dS71R8WH7qWvA/tvAAAAABJRU5ErkJggg==\'">\n</div>\n</div>\n<div class="dialog-tool">\n<span class="image-title"></span>\n<span href="#" class="image-title-box">{{title}}</span>\n<span href="#" class="close-dialog" ng-click="backoff()"></span>\n<span href="#" class="rotate-dialog" ng-click="rotate()"></span>\n<span href="#" ng-if="!single" ng-class="nextTrue?dialog2:cur" class="next-dialog" ng-click="next()"></span>\n<span href="#" ng-if="!single" ng-class="preTrue?dialog2:cur" class="previous-dialog" ng-click="previous()"></span>\n</div>\n</div>\n</div>\n',link:function(h,A){h.dialog2="next-dialog2",h.cur="cur",h.random=(new Date).getTime(),h.w=h.needlessSize&&h.width||100,h.h=h.needlessSize&&h.height||100,h.imgSize={width:h.w+"px",height:h.h+"px",display:"inline-block","margin-right":"5px"};var f=[],t=[];h.imgList=[],h.otherList=[];var v=1,p=0;if(h.cameraList){var e=h.cameraList;e&&(angular.forEach(e,function(e,n){f.push(e.url),t[n]=e.title}),1===e.length&&e[0].single?(console.log("single:",e[0].single),n(e[0].single)):n(!1))}function n(e){I(function(){h.single=e})}o.$on("ngdialog"+h.random,function(e,n){h.checkBigImg(n,f[n],t[n])});var x=0,b=0,i=0,a=0,r=1;function w(e){e.preventDefault();var n=A[0].style.transform;n.indexOf("scale(")&&(n=n.split(" ")[0]),e.wheelDelta?(0<e.wheelDelta&&(5<(r+=.1)&&(r=5),A.css({transform:n+" scale("+r+", "+r+")"})),e.wheelDelta<0&&((r-=.1)<.1&&(r=.1),A.css({transform:n+" scale("+r+", "+r+")"}))):e.detail&&(0<e.detail&&((r-=.1)<.1&&(r=.1),A.css({transform:n+" scale("+r+", "+r+")"})),e.detail<0&&(5<(r+=.1)&&(r=5),A.css({transform:n+" scale("+r+", "+r+")"})))}function k(e){i=e.clientX-x,a=e.clientY-b,A.css({top:a+"px",left:i+"px",transition:"left 0s, top 0s"})}function S(){B.off("mousemove",k),B.off("mouseup",S),A.css({transition:"all .6s"})}h.backoff=function(){h.isClose=!0,I(function(){h.isClose=!1,angular.element(jQuery("#ngdialog"+h.random)).css({display:"none"}),p=0},300)},h.rotate=function(){r=1,angular.element(jQuery("#ngdialog"+h.random)).find(".ngdialog-content-picture").css({transform:"rotate("+90*p+"deg)"}),p++},h.previous=function(){var e=v-1;if(!(e<0||e>f.length-1)){var n=f[e],i=t[e];h.checkBigImg(e,n,i)}},h.next=function(){var e=v+1;if(!(e<0||e>f.length-1)){var n=f[e],i=t[e];h.checkBigImg(e,n,i)}},h.checkBigImg=function(e,n,i){p=0,v=e,I(function(){h.title=i||null,h.rotate(),h.preTrue=!(0===e),h.nextTrue=!(e===f.length-1)});var t=new Image;t.src=n;var a=t.width,r=t.height,o=y.innerWidth,s=y.innerHeight-50;if(a<o&&r<s)a=a,r=r;else{var l=a/o,g=r/s;g<l?(a=o,r=parseInt(r/l)):(a=parseInt(a/g),r=s)}var d,c,u=((o-a)/2).toFixed(),m=((s-r)/2+50).toFixed();angular.element(jQuery("#ngdialog"+h.random)).css({display:"block"}),angular.element(jQuery("#ngdialog"+h.random)).find(".ngdialog-content-picture").css({width:a+"px",height:r+"px",top:m+"px",left:u+"px"}),angular.element(jQuery(".dialog-img")).attr("src",f[e]),angular.element(jQuery("#ngdialog"+h.random)).find(".dialog-img").bind("error",function(){angular.element(jQuery("#ngdialog"+h.random)).find(".ngdialog-content-picture").css({width:"140px",height:"140px",top:((y.innerHeight-140)/2).toFixed()+"px",left:((y.innerWidth-140)/2).toFixed()+"px"})}),(A=angular.element(jQuery("#ngdialog"+h.random)).find(".ngdialog-content-picture")).on("mousedown",function(e){e.preventDefault(),x=e.clientX-A[0].offsetLeft,b=e.clientY-A[0].offsetTop,B.on("mousemove",k),B.on("mouseup",S)}),d=-1<navigator.userAgent.indexOf("Firefox")?"DOMMouseScroll":"mousewheel",(c=document.getElementById("ngdialog"+h.random)).onmousewheel=w,document.addEventListener?c.addEventListener(d,w,!1):c.attachEvent("on"+d,w)}}}})}();